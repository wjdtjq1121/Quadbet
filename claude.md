# Quadbet - 티추 (Tichu) 카드 게임

## 프로젝트 개요
4인 전용 온라인 카드 게임 플랫폼

## 버전 히스토리

### v1.7.0 (2025-12-30)
- **봇 AI 조합 카드 우선 플레이 개선**
- 봇이 이제 트리플 > 페어 > 싱글 순서로 우선적으로 플레이
- 싱글만 내는 문제 해결
- **호랑이 → 불의 정령 아그니로 리브랜딩**
- 특수 카드명 변경: Tiger → Agni (불의 정령 아그니)
- 화려한 이모지: 🔥✨ (불과 반짝임)
- **티추 → 베팅 시스템 완전 개편**
- 용어 변경:
  - 그랜드 티추 → 그랜드 베팅 (GB)
  - 스몰 티추 → 쿼드 베팅 (QB)
- 그랜드 베팅: 처음 8장만 받았을 때 선언 가능 (카드를 내기 전)
  - 성공: +200점, 실패: -200점
- 쿼드 베팅: 카드를 낸 후에도 선언 가능
  - 성공: +100점, 실패: -100점
- cardsPlayed 추적: 카드를 냈는지 여부 추적
- 베팅 버튼 동적 텍스트: 카드를 내기 전에는 "베팅", 낸 후에는 "쿼드 베팅"
- bettingCalls 시스템: tichuCalls를 대체 (하위 호환성 유지)
- 점수 계산 로직 수정: endRound()에서 베팅 성공/실패 자동 계산
- 상세한 베팅 결과 로그 출력

### v1.6.0 (2025-12-30)
- **숫자 1 (마작) 소원 기능 완전 구현**
- 소원 시스템 추가:
  - gameState에 wish 필드 추가 (2~14 사이의 값)
  - 숫자 1을 낼 때 프롬프트로 소원 입력 (2~14)
  - 소원 카드가 있으면 반드시 포함시켜야 함
  - 조커(🃏)가 소원 카드 역할 가능
  - 스트레이트에 숫자 1 포함 시에도 소원 가능
- UI 개선:
  - 조합 타입 옆에 현재 소원 표시 (✨소원: X)
  - 소원 카드 강제 플레이 검증 메시지
- 봇 AI 개선:
  - 봇이 숫자 1을 내면 랜덤 소원 설정
  - 봇이 소원 카드를 우선적으로 플레이
  - 소원 카드가 있으면 반드시 포함하도록 로직 수정
- 소원 클리어 로직:
  - 소원 카드가 플레이되면 자동 클리어
  - 테이블 클리어 시 소원도 함께 클리어
- 헬퍼 함수 추가:
  - containsMahJong(cards): 카드 배열에 숫자 1 포함 여부
  - hasWishCard(hand, wish): 손패에 소원 카드 존재 여부
  - combinationContainsWish(combination, wish): 조합에 소원 카드 포함 여부

### v1.5.1 (2025-12-30)
- **패스 로직 동적 계산**: 나간 플레이어를 고려한 스마트 패스
- **봇 카드 공개**: 디버깅을 위해 모든 플레이어 카드 표시
- getRequiredPasses() 헬퍼 함수 추가
  - 활성 플레이어 수 계산 (4 - finishedPlayers.length)
  - 필요한 패스 수 = 활성 플레이어 - 1
  - 예: 1명 나감 → 2명 패스 필요, 2명 나감 → 1명 패스 필요
- passTurn() 개선: 동적 패스 계산 적용
- passBotTurn() 개선: 동적 패스 계산 적용
- UI 표시 개선: "패스 N/M" (M이 동적으로 변경)
- renderGame() 수정: 봇 카드를 앞면으로 표시 (클릭 불가)
- 상세한 콘솔 로그: 필요한 패스 수, 활성 플레이어 수

### v1.5.0 (2025-12-30)
- **특수카드 리브랜딩 및 고양이 기능 구현**
- 특수카드 이름 변경:
  - 마작 (🀄) → 숫자 1 (1)
  - 개 (🐕) → 고양이 (🐱)
  - 불사조 (🔥) → 컬러조커 (🃏)
  - 용 (🐉) → 호랑이 (🐯)
- **고양이 카드 기능 완전 구현**:
  - 고양이를 내면 파트너에게 턴 전달
  - 새 트릭 시작 시에만 사용 가능
  - 파트너가 원하는 조합을 낼 수 있음
  - 파트너가 이미 나갔다면 시계방향으로 다음 플레이어
  - 그 플레이어도 나갔다면 계속 시계방향
  - 최대 4명 체크 (모두 나간 경우 방지)
- 구버전 카드명 호환성 유지
- 상세한 콘솔 로그 (파트너 위치, 턴 전달 과정)

### v1.4.6 (2025-12-30)
- **티추 공식 룰 개선**: 3연속 패스 시 테이블 클리어 및 UI 표시
- 우측 하단 도움말 버튼 제거
- 패스 카운터 UI 표시 (예: "싱글 (패스 2/3)")
- 테이블 클리어 시 "새 트릭 - 아무 조합이나 가능" 표시
- playCards() 로그 강화 (카드 내기 시도, 유효성 검증)
- passTurn() 로그 강화 (연속 패스 카운터 표시)
- passBotTurn() 로그 강화 (봇 패스 시에도 동일한 로그)
- 연속 패스 카운터 리셋 로그 추가
- **티추 룰 준수**: 3명 패스 → 테이블 클리어 → 새 조합 가능

### v1.4.5 (2025-12-30)
- **봇 자동 플레이 로직 대폭 개선**: 봇이 자동으로 카드를 내도록 완전 재구성
- checkAndTriggerBotPlay() 헬퍼 함수 추가 (중앙화된 봇 턴 체크)
- startMultiplayerGame 개선: 초기 봇 턴과 Firebase 리스너에서 통합 호출
- 디버깅 로그 대폭 강화 (봇 턴 감지, 플레이어 추적, 상태 변화)
- nextTurn() 무한 루프 방지 (최대 4회 시도)
- syncGameState() 동기화 상태 상세 로그
- executeBotPlay() 초상세 로그 (구분선, 카드 상세 정보)
- renderGame() 완료 시 현재 플레이어 상태 로그
- 봇 타이머 중복 방지 (기존 타이머 취소)
- **목표**: 봇 3명이 자동으로 턴을 진행하도록

### v1.4.4 (2025-12-30)
- **완전한 방어 코드 구현**: 모든 에러 가능성 제거
- renderGame() 완전 try-catch 포장 + 각 루프별 에러 격리
- 모든 DOM 요소 null 체크 추가
- findBotPlay() 완전 검증 (null 손패, 유효하지 않은 카드)
- playBotCards() 강화 (gameState, hands, combination 검증)
- passBotTurn() 안전 처리 (consecutivePasses 초기화)
- 봇 에러 시 자동 패스 처리 (게임 중단 방지)
- 카드 렌더링 개별 try-catch
- 버튼 상태 업데이트 안전 처리
- **목표**: 어떤 상황에서도 게임이 멈추지 않도록

### v1.4.3 (2025-12-30)
- **핵심 버그 수정**: renderGame() undefined 에러 완전 해결
- Firebase 직렬화 문제 해결 (배열 ↔ 객체 변환)
- normalizeGameState() 함수 추가 (hands, tichuCalls 정규화)
- renderGame()에 완전한 null 안전 검사 추가
- 모든 플레이어 손패 검증 및 초기화
- DOM 요소 존재 확인 후 접근
- 게임 진행 안정성 대폭 향상

### v1.4.2 (2025-12-30)
- 게임 시작 에러 처리 대폭 강화
- "Script error." 문제 해결
- 전역 에러 핸들러 개선 (상세 스택 트레이스)
- startGame() 함수에 완전한 try-catch 추가
- initializeGameState() 검증 및 에러 처리
- 모든 게임 초기화 단계에 상세 로그
- 이벤트 리스너 등록 에러 방지

### v1.4.1 (2025-12-30)
- 게임 진행 로직 대폭 개선
- 봇 AI 에러 처리 강화
- 상세한 콘솔 로그 추가 (디버깅용)
- syncGameState 에러 처리
- 봇 플레이어 추적 개선
- 타임아웃 및 재시도 로직 추가

### v1.4.0 (2025-12-30)
- Firebase 보안 규칙 개선 (방장 권한 보호)
- SECURITY_RULES_EXPLAINED.md 문서 추가

### v1.3.1 (2025-12-30)
- Firebase 에러 처리 대폭 개선
- 5초 타임아웃 추가 (응답 없으면 자동 에러 표시)
- 사용자 친화적인 에러 메시지
- 에러 발생 시 setup.html로 자동 안내
- PERMISSION_DENIED 에러 자동 감지

### v1.3.0 (2025-12-30)
- Firebase 자동 배포 스크립트 추가 (deploy.bat, deploy.sh)
- database.rules.json 생성
- firebase.json, .firebaserc 설정

### v1.2.0 (2025-12-30)
- README.md 작성 (GitHub 메인 문서)
- setup.html 설정 가이드 페이지 추가
- index.html에 도움말 버튼 추가 (우측 하단)
- 사용자 친화적인 문제 해결 가이드

### v1.1.2 (2025-12-30)
- 전역 에러 핸들러 추가
- app.js 로드 확인을 위한 상세 로그 추가
- 함수 정의 확인 로그 추가
- test.html 테스트 페이지 생성 (디버깅용)

### v1.1.1 (2025-12-30)
- Firebase 연결 디버깅 로그 추가
- createRoom 함수에 상세 에러 처리 추가
- Firebase 초기화 및 연결 상태 확인 기능 추가
- FIREBASE_SETUP.md 문서 작성 (보안 규칙 설정 가이드)
- 사용자 정보 유효성 검사 추가

### v1.1.0 (2025-12-30)
- 테스트 봇 자동 참가 기능 추가
- 방장이 "봇으로 채우기" 버튼으로 빈 자리에 봇 추가 가능
- 봇 자동 플레이 AI 구현 (싱글, 페어, 트리플 지원)
- 봇 턴에 1-2초 딜레이 추가 (사람처럼 보이도록)
- 봇 이름: 알파봇, 베타봇, 감마봇, 델타봇 등

### v1.0.0 (2025-12-30)
- 초기 프로젝트 설정
- Firebase 멀티플레이어 기능 구현
- 싱글플레이어 모드 구현
- 게임 로직 및 UI 구현

## 파일 구조
- `index.html` - 메인 멀티플레이어 게임 페이지
- `Quadbet.html` - 싱글플레이어 게임 페이지
- `app.js` - Firebase 기반 게임 로직
- `claude.md` - 프로젝트 문서

## 주요 기능
- 온라인 멀티플레이어 (4인)
- 방 생성 및 참가
- 실시간 게임 진행
- 티추 선언 시스템
- 점수 계산
- 테스트용 봇 플레이어 자동 참가
- 봇 AI 자동 플레이

## 테스트 방법
1. 방을 생성하고 방장이 됩니다
2. "🤖 봇으로 채우기" 버튼을 클릭
3. 빈 자리가 자동으로 봇으로 채워집니다
4. 모든 플레이어가 준비되면 "게임 시작" 가능
5. 봇은 자동으로 카드를 플레이합니다

## 개발 노트
- Firebase Realtime Database 사용
- 반응형 UI 디자인
- 실시간 동기화

## Firebase 설정 필수!
⚠️ **중요**: 앱을 실행하기 전에 Firebase Realtime Database 보안 규칙을 설정해야 합니다.
자세한 내용은 `FIREBASE_SETUP.md` 파일을 참조하세요.

### 빠른 설정:
1. Firebase Console → Realtime Database → 규칙
2. 다음 규칙 복사 & 게시:
```json
{
  "rules": {
    ".read": true,
    ".write": true
  }
}
```

## 디버깅
브라우저 개발자 도구 (F12) → Console 탭에서 다음 로그 확인:
- `Firebase 초기화 성공`
- `Firebase 데이터베이스 연결됨`
- `createRoom 호출됨`
- `방 생성 성공!`
